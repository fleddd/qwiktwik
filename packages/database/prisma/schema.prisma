generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum Plan {
  FREE
  PRO
}

enum BillingInterval {
  MONTHLY
  YEARLY
  LIFETIME
  NONE
}

enum SubStatus {
  ACTIVE
  INACTIVE
  PAST_DUE
  CANCELED
}

enum TxStatus {
  PENDING
  COMPLETED
  FAILED
}

model User {
  id           String  @id @default(uuid())
  email        String  @unique
  passwordHash String?
  name         String?
  avatar       String?
  role         Role    @default(USER)

  subscription  Subscription?
  transactions  Transaction[]
  oauthAccounts OAuthAccount[]

  passwordResetToken   String?   @unique
  passwordResetExpires DateTime?
  passwordChangedAt    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Added model for Google/Discord logins
model OAuthAccount {
  id                String @id @default(uuid())
  userId            String
  provider          String
  providerAccountId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Subscription {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  plan     Plan            @default(FREE)
  status   SubStatus       @default(INACTIVE)
  interval BillingInterval @default(NONE)

  paymentProvider        String?
  providerCustomerId     String?
  providerSubscriptionId String?

  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  amount   Float
  currency String

  provider     String
  providerTxId String? @unique

  status       TxStatus        @default(PENDING)
  intervalPaid BillingInterval

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
